{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4>Gerçek Zamanlı Şişe Tespiti</h4>
                </div>
                <div class="card-body">
                    <div class="video-container">
                        <img src="{{ url_for('realtime.video_feed') }}" class="img-fluid" id="video-feed">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>Kontrol Paneli</h4>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" id="start-btn">Tespiti Başlat</button>
                        <button class="btn btn-danger" id="stop-btn" disabled>Tespiti Durdur</button>
                    </div>
                    <div class="mt-3">
                        <div class="alert alert-info" role="alert" id="status-message">
                            Tespit başlatılmadı
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.video-container {
    position: relative;
    width: 100%;
    padding-top: 56.25%; /* 16:9 Aspect Ratio */
    background-color: #000;
}

.video-container img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    const statusMessage = document.getElementById('status-message');
    const videoFeed = document.getElementById('video-feed');

    startBtn.addEventListener('click', function() {
        fetch('/realtime/start_detection', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                startBtn.disabled = true;
                stopBtn.disabled = false;
                statusMessage.textContent = 'Tespit başlatıldı';
                statusMessage.className = 'alert alert-success';
            } else {
                statusMessage.textContent = data.message;
                statusMessage.className = 'alert alert-danger';
            }
        })
        .catch(error => {
            statusMessage.textContent = 'Bir hata oluştu: ' + error;
            statusMessage.className = 'alert alert-danger';
        });
    });

    stopBtn.addEventListener('click', function() {
        fetch('/realtime/stop_detection', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                startBtn.disabled = false;
                stopBtn.disabled = true;
                statusMessage.textContent = 'Tespit durduruldu';
                statusMessage.className = 'alert alert-info';
            } else {
                statusMessage.textContent = data.message;
                statusMessage.className = 'alert alert-danger';
            }
        })
        .catch(error => {
            statusMessage.textContent = 'Bir hata oluştu: ' + error;
            statusMessage.className = 'alert alert-danger';
        });
    });
});
</script>
{% endblock %} 